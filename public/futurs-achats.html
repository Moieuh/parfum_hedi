<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Futurs achats - Parfums</title>
  <script src="script.js" defer></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <a href="index.html" class="logo" title="Accueil">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
        <circle cx="16" cy="16" r="15" stroke="#6366f1" stroke-width="2" fill="#fff"/>
        <path d="M16 10v8M16 18l-4 4M16 18l4 4" stroke="#00ff75" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </a>
    <nav>
      <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="collection.html">Collection</a></li>
        <li><a href="futurs-achats.html">Futurs achats</a></li>
      </ul>
    </nav>
    <a href="Login.html" id="user-name" class="user-name"></a>
  </header>
  <main>
  <h1>Futurs achats de parfums</h1>

  <!-- SECTION SLIDER DES PREFERES -->
  <div id="section-slider-pref" style="margin-bottom:32px;">
  <h2 style="color:#00ff75;">Mes futurs achats prioritaires ‚≠ê</h2>
  <div id="slider-pref" class="slider"></div>
</div>


  <!-- FORMULAIRE ET LISTE CLASSIQUE -->
  <form id="ajout-futur-achat" style="margin-bottom:18px;">
    <input type="text" id="futur-nom" placeholder="Nom du parfum" required />
    <input type="text" id="futur-marque" placeholder="Marque" />
    <input type="number" id="futur-prix" placeholder="Prix estim√© (‚Ç¨)" min="0" step="0.01"/>
    <button type="submit">Ajouter √† la liste</button>
  </form>
  <ul id="liste-futurs-achats"></ul>
</main>

  <footer>
    <p>&copy; 2025 Parf. Tous droits r√©serv√©s.</p>
  </footer>
  <script>
  // --- Donn√©es en localStorage ---
  function getFutursAchats() {
    return JSON.parse(localStorage.getItem('futursAchats') || '[]');
  }
  function setFutursAchats(list) {
    localStorage.setItem('futursAchats', JSON.stringify(list));
  }
  // Images "prio" dans localStorage √† part (cl√© = nom unique !)
  function getPrioImages() {
    return JSON.parse(localStorage.getItem('futursPrioImages') || '{}');
  }
  function setPrioImages(obj) {
    localStorage.setItem('futursPrioImages', JSON.stringify(obj));
  }

  function getNbPrio() {
    return getFutursAchats().filter(item => item.prioritaire).length;
  }

  function afficherSliderPrio() {
    const liste = getFutursAchats();
    const prioImages = getPrioImages();
    // Limite √† 5 "prioritaires"
    const prios = liste.filter(item => item.prioritaire).slice(0, 5);
    const slider = document.getElementById('slider-pref');
    if (!prios.length) {
      slider.innerHTML = '<div style="color:#a5b4fc;text-align:center;padding:18px;">S√©lectionnez vos priorit√©s ‚≠ê</div>';
      return;
    }
    slider.innerHTML = `<div class="slider-list"></div>`;
    const sliderList = slider.querySelector('.slider-list');
    prios.forEach((item, idx) => {
    const image = prioImages[item.nom] || 'https://cdn-icons-png.flaticon.com/512/748/748111.png';
    const delayAuto = (idx * 2.5) + 's'; // d√©calage d√©filement (autoRun)
    const delayShow = (idx * 2.5) + 's'; // 1s de d√©calage entre chaque apparition
    sliderList.innerHTML += `
      <div class="slider-item" style="--delayShow:${delayShow}; --delayAuto:${delayAuto};">
        <div class="card">
          <img src="${image}" class="slider-img" alt="Parfum prioritaire">
          <div style="margin-bottom:8px;">
            <span class="pref-star">‚≠ê</span>
            <b>${item.nom}</b>
          </div>
          <div>${item.marque ? '('+item.marque+')' : ''}</div>
          <div>${item.prix ? 'üí∏ '+item.prix+' ‚Ç¨' : ''}</div>
          <button class="btn-img" onclick="document.getElementById('img-input-${idx}').click()">Changer l'image</button>
          <input type="file" id="img-input-${idx}" accept="image/*" style="display:none;" onchange="onPrioImageSelected('${item.nom}', this)">
        </div>
      </div>
    `;
  });

  }

  // Fonction d‚Äôupload image pour une priorit√©
  window.onPrioImageSelected = function(nom, input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const prioImages = getPrioImages();
        prioImages[nom] = e.target.result;
        setPrioImages(prioImages);
        afficherSliderPrio();
      };
      reader.readAsDataURL(input.files[0]);
    }
  };

  // Liste classique, cards + bouton "‚≠ê" (prioritaire)
  function afficherFutursAchats() {
    const liste = getFutursAchats();
    const prioImages = getPrioImages();
    const nbPrio = liste.filter(item => item.prioritaire).length;
    const ul = document.getElementById('liste-futurs-achats');
    ul.className = 'futur-card-list';
    ul.innerHTML = '';
    liste.forEach((item, idx) => {
      const isPrio = !!item.prioritaire;
      const image = prioImages[item.nom] || '';
      const disabled = (!isPrio && nbPrio >= 4) ? 'disabled' : '';
      const btnTitle = isPrio
        ? 'Retirer des priorit√©s'
        : (nbPrio >= 5 ? 'Vous ne pouvez avoir que 4 priorit√©s' : 'Ajouter aux priorit√©s');
      const li = document.createElement('li');
      li.className = 'futur-card';
      li.innerHTML = `
        <button class="futur-card-delete" title="Supprimer" onclick="supprimerFuturAchat(${idx})">‚ùå</button>
        <button class="btn-pref${isPrio ? ' selected' : ''}" onclick="togglePrio(${idx})" title="${btnTitle}" ${disabled}>
          ‚≠ê
        </button>
        <strong>${item.nom}</strong>
        ${item.marque ? `<div>(${item.marque})</div>` : ''}
        ${item.prix ? `<div style="margin-top:6px;">üí∏ ${item.prix} ‚Ç¨</div>` : ''}
      `;
      ul.appendChild(li);
    });
    afficherSliderPrio();
  }

  window.supprimerFuturAchat = function(idx) {
    const liste = getFutursAchats();
    const nom = liste[idx].nom;
    liste.splice(idx, 1);
    setFutursAchats(liste);
    // Aussi supprimer image associ√©e si prioritaire
    const prioImages = getPrioImages();
    if (prioImages[nom]) { delete prioImages[nom]; setPrioImages(prioImages);}
    afficherFutursAchats();
  }

  window.togglePrio = function(idx) {
    const liste = getFutursAchats();
    // Si on veut activer et d√©j√† 4 prio, on bloque
    if (!liste[idx].prioritaire && liste.filter(x => x.prioritaire).length >= 4) return;
    liste[idx].prioritaire = !liste[idx].prioritaire;
    setFutursAchats(liste);
    afficherFutursAchats();
  }

  document.getElementById('ajout-futur-achat').onsubmit = function(e) {
    e.preventDefault();
    const nom = document.getElementById('futur-nom').value.trim();
    const marque = document.getElementById('futur-marque').value.trim();
    const prix = document.getElementById('futur-prix').value.trim();
    if (!nom) return;
    const liste = getFutursAchats();
    if (liste.some(item => item.nom === nom)) return alert('Ce parfum est d√©j√† dans la liste.');
    liste.push({ nom, marque, prix });
    setFutursAchats(liste);
    afficherFutursAchats();
    this.reset();
  };

  document.addEventListener('DOMContentLoaded', () => {
    const user = localStorage.getItem('utilisateur') || '';
    document.getElementById('user-name').textContent = user;
    afficherFutursAchats();
  });
</script>


</body>
</html>
